# ERD优化功能测试指南

## 快速测试步骤

### 1. 启动应用

```bash
# 在SPDSQL目录下
npm start
# 或使用
start.bat  # Windows
start.sh   # Linux/Mac
```

### 2. 进入ERD页面

1. 打开浏览器访问应用
2. 点击导航进入"实体关系图"页面

### 3. 测试卡片美观度

**预期效果:**

✅ **表头区域**
- 渐变背景(蓝色渐变)
- 左侧显示拖拽手柄图标(≡)
- 表名和字段数量显示清晰
- 右上角有关闭按钮

✅ **字段列表区域**
- 交替背景色(斑马纹效果)
- 复选框选择字段时背景变蓝
- hover字段行时背景变灰
- 字段名和类型标签清晰可读

✅ **整体样式**
- 卡片宽度280px,足够宽
- 圆角8px,现代化
- hover卡片时边框变蓝色加粗
- 阴影效果明显

**测试步骤:**
1. 点击"刷新"按钮加载表列表
2. 点击任意表名添加到画布
3. 观察卡片外观是否符合预期
4. hover卡片观察hover效果
5. 选择几个字段观察选中状态

### 4. 测试连接端口

**预期效果:**

✅ **端口显示**
- 默认情况下端口隐藏
- hover字段行时左右端口出现
- 端口为圆形,蓝色边框,中间有加号

✅ **端口动画**
- 端口出现时有淡入+缩放动画
- hover端口时进一步放大并发光

**测试步骤:**
1. 添加至少2个表到画布
2. 将鼠标移到字段行上
3. 观察左右端口是否出现
4. hover端口观察放大和发光效果

### 5. 测试连接创建

**预期效果:**

✅ **拖拽过程**
- 按住端口拖拽时画布光标变为十字
- 实时显示临时连接线跟随鼠标
- 所有端口变为可见状态

✅ **完成连接**
- 释放到目标端口上创建连接
- 释放到空白处取消连接
- 按Esc键取消连接

**测试步骤:**
1. 从第一个表的某字段端口按住鼠标
2. 拖动到第二个表的某字段端口
3. 释放鼠标完成连接
4. 观察连接线是否创建成功

### 6. 测试JOIN类型标签

**预期效果:**

✅ **标签显示**
- 连接线中点位置显示标签
- 默认显示"内连接"
- 标签为圆角矩形,蓝色边框和文字
- hover标签时略微放大

✅ **颜色对应**
- 内连接: 蓝色 (#2196f3)
- 左连接: 绿色 (#4caf50)
- 右连接: 橙色 (#ff9800)
- 全连接: 紫色 (#9c27b0)
- 交叉连接: 红色 (#f44336)

**测试步骤:**
1. 创建一条连接
2. 观察连接线中点是否显示"内连接"标签
3. 标签颜色是否为蓝色

### 7. 测试JOIN类型切换

**预期效果:**

✅ **选择器显示**
- 点击标签弹出选择器
- 显示5种JOIN类型选项
- 每个选项左侧有彩色边框
- 当前选中项右侧显示对勾

✅ **切换效果**
- 点击其他类型立即切换
- 标签文字和颜色同步更新
- 连接线颜色同步更新

**测试步骤:**
1. 点击连接线上的"内连接"标签
2. 观察是否弹出选择器,显示5个选项
3. 点击"左连接"选项
4. 观察标签是否变为"左连接",颜色变为绿色
5. 观察连接线颜色是否变为绿色
6. 依次测试其他JOIN类型

### 8. 测试关联高亮

**预期效果:**

✅ **hover卡片效果**
- hover某个表卡片时,该卡片边框变为蓝色加粗
- 卡片背景变为极浅蓝色
- 与该表相关的所有连接线高亮(加粗+发光)
- 无关的连接线变暗(半透明灰色)

✅ **离开效果**
- 鼠标移出卡片后高亮效果消失
- 所有连接线恢复正常状态

**测试步骤:**
1. 创建3个表,建立2-3条连接
2. hover第一个表
3. 观察与该表相关的连接线是否加粗发光
4. 观察无关连接线是否变暗
5. 移出鼠标观察是否恢复正常
6. 依次hover其他表测试

### 9. 测试SQL生成

**预期效果:**

✅ **JOIN关键字正确**
- 内连接生成`INNER JOIN`
- 左连接生成`LEFT JOIN`
- 右连接生成`RIGHT JOIN`
- 全连接生成`FULL OUTER JOIN`
- 交叉连接生成`CROSS JOIN`

✅ **SQL格式**
- SELECT子句包含所有选中字段
- FROM子句指定主表
- JOIN子句按连接顺序排列
- ON条件正确匹配字段

**测试步骤:**
1. 添加3个表,选择一些字段
2. 创建2条连接,分别设置为不同JOIN类型(如INNER和LEFT)
3. 点击"生成SQL"按钮
4. 观察SQL面板显示的SQL语句
5. 检查JOIN关键字是否正确
6. 检查字段、表名、ON条件是否正确

### 10. 综合场景测试

**场景1: 订单-客户-产品关联**

1. 添加orders, customers, products三个表
2. 创建连接:
   - orders.customer_id → customers.customer_id (LEFT JOIN)
   - orders.product_id → products.product_id (INNER JOIN)
3. 选择字段:
   - orders.order_id
   - customers.customer_name
   - products.product_name
4. hover orders表,观察两条连接线都高亮
5. hover customers表,观察只有第一条连接线高亮
6. 生成SQL,检查结果

**预期SQL:**
```sql
SELECT
  public.orders.order_id,
  public.customers.customer_name,
  public.products.product_name
FROM public.orders
LEFT JOIN public.customers ON public.orders.customer_id = public.customers.customer_id
INNER JOIN public.products ON public.orders.product_id = public.products.product_id;
```

**场景2: 多连接线高亮**

1. 添加4个表
2. 创建连接使某个表连接到其他3个表
3. hover该中心表
4. 观察3条连接线同时高亮

## 常见问题排查

### 问题1: 端口不显示
- 检查: 是否hover到字段行上
- 解决: 确保鼠标在字段行区域内

### 问题2: 连接线没有标签
- 检查: 是否使用了新的joinEdge类型
- 解决: 检查edgeTypes是否正确注册

### 问题3: JOIN类型切换无效
- 检查: 点击标签后是否弹出选择器
- 解决: 检查Menu组件是否正确渲染

### 问题4: 高亮不工作
- 检查: hover卡片时边框是否变蓝
- 解决: 检查onCardHover回调是否正确传递

### 问题5: SQL生成错误
- 检查: 边数据是否包含joinType字段
- 解决: 检查onConnect函数是否设置默认值

## 性能测试

### 大量节点测试
1. 添加10-20个表到画布
2. 创建多条连接
3. 测试hover响应速度
4. 观察是否有明显卡顿

### 频繁操作测试
1. 快速添加/删除表
2. 快速创建/删除连接
3. 快速切换JOIN类型
4. 观察内存占用和性能

## 测试清单

- [ ] 卡片渐变表头显示正常
- [ ] 卡片宽度280px,圆角8px
- [ ] 字段列表交替背景色
- [ ] 端口hover显示/隐藏
- [ ] 端口动画效果
- [ ] 拖拽创建连接
- [ ] 临时连接线预览
- [ ] JOIN标签显示在连接线中点
- [ ] 点击标签弹出选择器
- [ ] 5种JOIN类型都可选择
- [ ] JOIN类型切换后颜色更新
- [ ] hover卡片时相关连接线高亮
- [ ] 无关连接线变暗
- [ ] 移出卡片后恢复正常
- [ ] SQL生成JOIN关键字正确
- [ ] 插入编辑器功能正常

## 通过标准

所有测试清单项都应该✅通过,才表示优化功能完全正常。

## 报告问题

如发现问题,请记录:
1. 问题描述
2. 重现步骤
3. 预期行为
4. 实际行为
5. 截图或视频(如有)
