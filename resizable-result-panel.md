# å¯è°ƒèŠ‚ç»“æœé¢æ¿å®Œæ•´å®ç°

## âœ… å·²å®ç°åŠŸèƒ½

### 1. ç»“æœé¢æ¿åœ¨ç¼–è¾‘å™¨åŒºåŸŸå†…æ˜¾ç¤º
- âœ… ç»“æœé¢æ¿ä¸ç¼–è¾‘å™¨å…±äº«åŒä¸€ä¸ªå®¹å™¨ç©ºé—´
- âœ… é»˜è®¤å ç”¨ç¼–è¾‘å™¨ä¸‹æ–¹30%çš„é«˜åº¦
- âœ… æ‰§è¡ŒSQLåè‡ªåŠ¨å±•å¼€ï¼ŒæŠ˜å åç¼–è¾‘å™¨å æ»¡100%

### 2. å¯æŠ˜å è®¾è®¡
- âœ… ç‚¹å‡»"æŠ˜å "æŒ‰é’®å…³é—­ç»“æœé¢æ¿
- âœ… SQLæ‰§è¡Œåè‡ªåŠ¨å±•å¼€ç»“æœé¢æ¿
- âœ… ç»“æœé¢æ¿çŠ¶æ€æŒä¹…åŒ–åˆ°localStorage

### 3. å¯æ‹–åŠ¨è°ƒæ•´é«˜åº¦
- âœ… ç¼–è¾‘å™¨ä¸ç»“æœé¢æ¿ä¹‹é—´æœ‰8pxé«˜çš„æ¨ªå‘æ‹–åŠ¨æ¡
- âœ… é¼ æ ‡æ‚¬åœæ—¶é«˜äº®æ˜¾ç¤º
- âœ… æ‹–åŠ¨æ—¶å…‰æ ‡å˜ä¸º`row-resize`
- âœ… é«˜åº¦æ¯”ä¾‹é™åˆ¶åœ¨20%-70%ä¹‹é—´
- âœ… é«˜åº¦è®¾ç½®æŒä¹…åŒ–ä¿å­˜

### 4. åŒæ ‡ç­¾é¡µ
- âœ… **ç»“æœæ ‡ç­¾** - æ˜¾ç¤ºæŸ¥è¯¢æ•°æ®ç½‘æ ¼
- âœ… **ä¿¡æ¯æ ‡ç­¾** - æ˜¾ç¤ºæ‰§è¡ŒçŠ¶æ€ã€è€—æ—¶ã€é”™è¯¯ç­‰

### 5. æ— å‚ç›´æ»šåŠ¨æ¡
- âœ… æ•´ä¸ªé¡µé¢ä¸¥æ ¼æ§åˆ¶åœ¨100vhå†…
- âœ… ç»“æœå†…å®¹åŒºåŸŸå†…éƒ¨æ»šåŠ¨
- âœ… çª—å£å¤§å°æ”¹å˜æ—¶è‡ªåŠ¨é€‚åº”

## ğŸ¨ UIè®¾è®¡

### å¸ƒå±€ç»“æ„
```
ç¼–è¾‘å™¨å®¹å™¨ (flex: 1)
â”œâ”€ å·¥å…·æ  (å›ºå®šé«˜åº¦ 48px)
â”œâ”€ åˆ†éš”çº¿ (1px)
â””â”€ ç¼–è¾‘å™¨+ç»“æœåŒºåŸŸ (flex: 1)
    â”œâ”€ Monacoç¼–è¾‘å™¨ (åŠ¨æ€é«˜åº¦ 70%-100%)
    â”œâ”€ æ¨ªå‘æ‹–åŠ¨æ¡ (8px, å¯æ‹–åŠ¨)
    â””â”€ ç»“æœé¢æ¿ (åŠ¨æ€é«˜åº¦ 30%-20%)
        â”œâ”€ æ ‡ç­¾æ  (40px)
        â””â”€ å†…å®¹åŒº (flex: 1, å¯æ»šåŠ¨)
```

### æ‹–åŠ¨æ¡æ ·å¼
```typescript
{
  height: 8,
  cursor: 'row-resize',
  bgcolor: æ‹–åŠ¨æ—¶ ? '#e0e0e0' : '#f5f5f5',
  display: 'flex',
  alignItems: 'center',
  justifyContent: 'center',
  '&:hover': { bgcolor: '#e8e8e8' }
}
```

### ä¸­é—´æ‰‹æŸ„
```typescript
{
  width: 48,
  height: 4,
  borderRadius: 2,
  bgcolor: '#bbb'
}
```

## ğŸ”§ æŠ€æœ¯å®ç°

### çŠ¶æ€ç®¡ç†
```typescript
const [resultPanelOpen, setResultPanelOpen] = useState(false)
const [resultTab, setResultTab] = useState(0)
const [resultHeight, setResultHeight] = useState(30) // ç™¾åˆ†æ¯”
const [isResizingResult, setIsResizingResult] = useState(false)
```

### æ‹–åŠ¨é€»è¾‘
```typescript
useEffect(() => {
  const onMove = (e: MouseEvent) => {
    if (!isResizingResult || !editorContainerRef.current) return
    const containerHeight = editorContainerRef.current.getBoundingClientRect().height
    const delta = e.clientY - resultStartYRef.current
    const deltaPct = (delta / containerHeight) * 100
    const minPct = 20 // æœ€å°20%
    const maxPct = 70 // æœ€å¤§70%
    const nextPct = Math.min(Math.max(resultStartHeightRef.current - deltaPct, minPct), maxPct)
    setResultHeight(nextPct)
  }
  // ... mouseup handler
}, [isResizingResult, resultHeight])
```

### é«˜åº¦è®¡ç®—
```typescript
// ç¼–è¾‘å™¨é«˜åº¦ = 100% - ç»“æœé¢æ¿é«˜åº¦
<Box sx={{ flex: resultPanelOpen ? `1 1 ${100 - resultHeight}%` : '1 1 100%' }}>
  <Editor />
</Box>

// ç»“æœé¢æ¿é«˜åº¦ = ç”¨æˆ·è®¾ç½®çš„ç™¾åˆ†æ¯”
<Box sx={{ flex: `0 0 ${resultHeight}%` }}>
  {/* ç»“æœå†…å®¹ */}
</Box>
```

## ğŸ“‹ äº¤äº’æµç¨‹

### æ‰§è¡ŒSQLæµç¨‹
```mermaid
graph LR
    A[ç‚¹å‡»è¿è¡Œ] --> B[å‘é€è¯·æ±‚]
    B --> C{æˆåŠŸ?}
    C -->|æ˜¯| D[å±•å¼€ç»“æœé¢æ¿]
    C -->|å¦| E[å±•å¼€ç»“æœé¢æ¿]
    D --> F[åˆ‡æ¢åˆ°ç»“æœæ ‡ç­¾]
    E --> G[åˆ‡æ¢åˆ°ä¿¡æ¯æ ‡ç­¾]
    F --> H[æ˜¾ç¤ºæ•°æ®ç½‘æ ¼]
    G --> I[æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯]
```

### æ‹–åŠ¨è°ƒæ•´æµç¨‹
```mermaid
graph LR
    A[é¼ æ ‡æŒ‰ä¸‹æ¨ªæ¡] --> B[è®°å½•èµ·å§‹ä½ç½®]
    B --> C[è®¾ç½®isResizingResult=true]
    C --> D[ç›‘å¬mousemove]
    D --> E[è®¡ç®—æ–°é«˜åº¦]
    E --> F[æ›´æ–°resultHeight]
    F --> G[é‡æ–°æ¸²æŸ“]
    G --> H{ç»§ç»­æ‹–åŠ¨?}
    H -->|æ˜¯| D
    H -->|å¦| I[mouseup]
    I --> J[ä¿å­˜åˆ°localStorage]
```

## ğŸ¯ ç”¨æˆ·æ“ä½œ

### 1. æŸ¥çœ‹æŸ¥è¯¢ç»“æœ
```
1. æ‰§è¡Œ SELECT æŸ¥è¯¢
2. ç»“æœé¢æ¿è‡ªåŠ¨å±•å¼€(é»˜è®¤30%é«˜åº¦)
3. åœ¨"ç»“æœ"æ ‡ç­¾æŸ¥çœ‹æ•°æ®ç½‘æ ¼
4. æ»šåŠ¨æŸ¥çœ‹æ›´å¤šæ•°æ®
```

### 2. è°ƒæ•´é¢æ¿é«˜åº¦
```
1. å°†é¼ æ ‡æ‚¬åœåœ¨ç¼–è¾‘å™¨å’Œç»“æœä¹‹é—´çš„æ¨ªæ¡ä¸Š
2. å…‰æ ‡å˜ä¸ºä¸Šä¸‹ç®­å¤´(row-resize)
3. æŒ‰ä½é¼ æ ‡å·¦é”®æ‹–åŠ¨
4. å‘ä¸Šæ‹– â†’ ç»“æœé¢æ¿å˜å¤§ï¼Œç¼–è¾‘å™¨å˜å°
5. å‘ä¸‹æ‹– â†’ ç»“æœé¢æ¿å˜å°ï¼Œç¼–è¾‘å™¨å˜å¤§
6. é‡Šæ”¾é¼ æ ‡ä¿å­˜è®¾ç½®
```

### 3. æŠ˜å ç»“æœé¢æ¿
```
1. ç‚¹å‡»å³ä¸Šè§’"æŠ˜å "æŒ‰é’®
2. ç»“æœé¢æ¿æ”¶èµ·
3. ç¼–è¾‘å™¨è‡ªåŠ¨å æ»¡100%é«˜åº¦
```

### 4. æŸ¥çœ‹æ‰§è¡Œä¿¡æ¯
```
1. ç‚¹å‡»"ä¿¡æ¯"æ ‡ç­¾
2. æŸ¥çœ‹æ‰§è¡ŒçŠ¶æ€ã€è¡Œæ•°ã€è€—æ—¶ç­‰
3. å¦‚æœ‰é”™è¯¯ï¼Œæ˜¾ç¤ºé”™è¯¯è¯¦æƒ…
4. ç‚¹å‡»"AIè¯Šæ–­å¹¶ä¿®æ­£"è·å–å¸®åŠ©
```

## ğŸ“ é«˜åº¦é™åˆ¶

| åŒºåŸŸ | æœ€å°é«˜åº¦ | æœ€å¤§é«˜åº¦ | é»˜è®¤é«˜åº¦ |
|------|---------|---------|---------|
| ç¼–è¾‘å™¨ | 30% | 80% | 70% (æœ‰ç»“æœ) / 100% (æ— ç»“æœ) |
| ç»“æœé¢æ¿ | 20% | 70% | 30% |

## ğŸ’¾ æŒä¹…åŒ–

### LocalStorageå­˜å‚¨
```typescript
// ä¿å­˜ç»“æœé¢æ¿é«˜åº¦
localStorage.setItem('result_panel_height', String(resultHeight))

// è¯»å–ç»“æœé¢æ¿é«˜åº¦
const savedHeight = localStorage.getItem('result_panel_height')
const height = savedHeight ? Number(savedHeight) : 30
```

## âœ… æµ‹è¯•æ¸…å•

- [x] æ‰§è¡ŒSQLåç»“æœé¢æ¿è‡ªåŠ¨å±•å¼€
- [x] ç»“æœé¢æ¿æ˜¾ç¤ºåœ¨ç¼–è¾‘å™¨ä¸‹æ–¹(å…±äº«ç©ºé—´)
- [x] æ— å‚ç›´æ»šåŠ¨æ¡
- [x] å¯ä»¥å‘ä¸Šæ‹–åŠ¨æ¨ªæ¡å¢å¤§ç»“æœé¢æ¿
- [x] å¯ä»¥å‘ä¸‹æ‹–åŠ¨æ¨ªæ¡å‡å°ç»“æœé¢æ¿
- [x] æ‹–åŠ¨æ—¶å…‰æ ‡å˜ä¸ºrow-resize
- [x] é«˜åº¦é™åˆ¶åœ¨20%-70%ä¹‹é—´
- [x] æŠ˜å åç¼–è¾‘å™¨å æ»¡100%
- [x] å†æ¬¡æ‰§è¡ŒSQLæ—¶é‡æ–°å±•å¼€
- [x] é«˜åº¦è®¾ç½®åˆ·æ–°åä¿æŒ
- [x] ç»“æœ/ä¿¡æ¯æ ‡ç­¾åˆ‡æ¢æ­£å¸¸
- [x] æ•°æ®ç½‘æ ¼æ˜¾ç¤ºæ­£å¸¸
- [x] é”™è¯¯ä¿¡æ¯æ˜¾ç¤ºæ­£å¸¸
- [x] CSVå¯¼å‡ºåŠŸèƒ½æ­£å¸¸
- [x] AIè¯Šæ–­åŠŸèƒ½æ­£å¸¸

## ğŸš€ ä¼˜åŒ–å»ºè®®

### 1. å¿«æ·é”®æ”¯æŒ
```typescript
// Ctrl+` åˆ‡æ¢ç»“æœé¢æ¿
useEffect(() => {
  const handleKeyDown = (e: KeyboardEvent) => {
    if (e.ctrlKey && e.key === '`') {
      setResultPanelOpen(prev => !prev)
    }
  }
  window.addEventListener('keydown', handleKeyDown)
  return () => window.removeEventListener('keydown', handleKeyDown)
}, [])
```

### 2. æœ€å¤§åŒ–/æœ€å°åŒ–
```typescript
// åŒå‡»æ¨ªæ¡å¿«é€Ÿåˆ‡æ¢
onDoubleClick={() => {
  setResultHeight(resultHeight > 50 ? 20 : 70)
}}
```

### 3. è®°ä½æ¯ä¸ªæŸ¥è¯¢çš„é¢æ¿çŠ¶æ€
```typescript
// æŒ‰æŸ¥è¯¢IDä¿å­˜çŠ¶æ€
const queryPanelState = useMemo(() => ({
  [queryId]: { open: resultPanelOpen, height: resultHeight, tab: resultTab }
}), [queryId, resultPanelOpen, resultHeight, resultTab])
```

## ğŸ‰ æ€»ç»“

ç°åœ¨ç»“æœé¢æ¿:
1. âœ… å®Œå…¨åœ¨ç¼–è¾‘å™¨åŒºåŸŸå†…æ˜¾ç¤º
2. âœ… å¯ä»¥è‡ªç”±æ‹–åŠ¨è°ƒæ•´é«˜åº¦
3. âœ… åŒæ ‡ç­¾é¡µæ¸…æ™°å±•ç¤ºç»“æœå’Œä¿¡æ¯
4. âœ… å§‹ç»ˆåœ¨å±å¹•å¯è§èŒƒå›´å†…
5. âœ… æ— é¡µé¢æ»šåŠ¨æ¡

ç”¨æˆ·ä½“éªŒå¤§å¹…æå‡ï¼ğŸŠ
